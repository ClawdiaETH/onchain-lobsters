# ðŸ¦ž Onchain Lobsters

**8,004 generative pixel lobsters. Fully onchain. Minting burns $CLAWDIA forever.**

> 40Ã—52 pixel art sprites rendered entirely in Solidity. No IPFS. No metadata servers. Every lobster lives onchain forever â€” the art is the contract.

[![Base](https://img.shields.io/badge/chain-Base-0052FF?style=flat-square)](https://base.org)
[![License: MIT](https://img.shields.io/badge/license-MIT-green?style=flat-square)](LICENSE)

---

## What is this?

Onchain Lobsters is a generative NFT collection deployed on Base. Every trait, every pixel, every SVG is computed directly from the token's seed by the Solidity contract at mint time â€” no external storage, no IPFS, no pinning services.

**Mint mechanic:**
1. Commit â€” pay 0.005 ETH, lock a commitment hash onchain
2. Wait â€” 1 to 100 blocks for randomness to settle
3. Reveal â€” seed derived from your commitment + a future blockhash; half the ETH swaps to $CLAWDIA and burns it; your lobster is minted

---

## Traits

| Trait | Variants | Notes |
|-------|----------|-------|
| Mutation | 8 | Controls body color + shape (Classic, Calico, Phantom, Ghostâ€¦) |
| Scene | 8 | Background environment |
| Marking | 8 | Shell stripe patterns |
| Claws | 6 | Claw shape variants |
| Eyes | 7 | Eye style (including Nounish pixel eyes) |
| Accessory | 11 | Hat, pipe, halo, crown, monocleâ€¦ |
| Tail | 5 | Tail fan shape |
| Broken antenna | ~15% | One antenna damaged |
| **Special** | 5 | Ghost / Infernal / Celestial / Nounish / Doodled (override common traits) |

Specials use trait overrides â€” e.g., every Ghost forces `mutation=3, eyes=4, scene=7`. Trait decoding mirrors the Solidity `TraitDecode.sol` exactly so the JS renderer always matches.

---

## Tokenomics

- **Supply:** 8,004
- **Mint price:** 0.005 ETH
- **On every mint:** 50% of ETH swapped for [$CLAWDIA](https://basescan.org/token/0xbbd9aDe16525acb4B336b6dAd3b9762901522B07) via Uniswap V3, sent to `0x000...dEaD`
- **Remaining 50%:** goes to treasury
- **$CLAWDIA CA:** `0xbbd9aDe16525acb4B336b6dAd3b9762901522B07`
- **Contract:** TBD (post-deploy)

---

## Repo structure

```
onchain-lobsters/
â”œâ”€â”€ app/                      # Next.js 14 App Router frontend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx          # Gallery / hero landing
â”‚   â”‚   â”œâ”€â”€ mint/page.tsx     # Mint UI (commit-reveal flow)
â”‚   â”‚   â””â”€â”€ api/og/[tokenId]/ # On-the-fly OG images via next/og
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ HeroMosaic.tsx    # Animated 3D-flip lobster grid
â”‚   â”‚   â”œâ”€â”€ GalleryGrid.tsx   # Minted lobster gallery
â”‚   â”‚   â”œâ”€â”€ LobsterCanvas.tsx # Canvas renderer (client-side)
â”‚   â”‚   â”œâ”€â”€ TraitSheet.tsx    # Post-mint trait breakdown
â”‚   â”‚   â”œâ”€â”€ Nav.tsx           # Sticky navbar + wallet connect
â”‚   â”‚   â”œâ”€â”€ Ticker.tsx        # Scrolling stats ticker
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ hooks/                # useCommit, useReveal, usePendingCommit, useBlockCountdown
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ renderer.ts       # TypeScript pixel renderer (mirrors PixelRenderer.sol)
â”‚       â”œâ”€â”€ traits.ts         # Seed â†’ traits decoder (mirrors TraitDecode.sol)
â”‚       â””â”€â”€ salt.ts           # Commit salt gen / localStorage persistence
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ OnchainLobsters.sol   # Main ERC-721 + commit-reveal + swap-and-burn
â”‚   â”œâ”€â”€ PixelRenderer.sol     # ~800-line Solidity SVG builder (RLE compressed)
â”‚   â”œâ”€â”€ TraitDecode.sol       # Weighted trait decode + attributes() JSON
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ Base64.sol        # Base64 encoder
â”‚       â””â”€â”€ SSTORE2.sol       # Onchain storage helper
â”œâ”€â”€ test/
â”‚   â””â”€â”€ OnchainLobsters.t.sol # 53-test Foundry suite
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ deploy.ts             # Foundry deploy script
â””â”€â”€ foundry.toml
```

---

## Local development

### Prerequisites

- [Node.js](https://nodejs.org) 18+
- [Foundry](https://getfoundry.sh)
- A Base RPC URL (e.g., [Alchemy](https://alchemy.com))

### Frontend

```bash
cd app
npm install
npm run dev
# â†’ http://localhost:3000
```

### Smart contracts

```bash
# Install deps
forge install

# Build
forge build

# Test (53 tests)
forge test -vv

# Deploy to Base
forge script scripts/deploy.ts \
  --rpc-url $BASE_RPC_URL \
  --private-key $DEPLOYER_KEY \
  --broadcast

# Set contract address in app
echo "NEXT_PUBLIC_CONTRACT_ADDRESS=0x..." >> app/.env.local
```

### Environment variables

Copy `app/.env.example` and fill in:

```
NEXT_PUBLIC_CONTRACT_ADDRESS=0x...    # After deploy
NEXT_PUBLIC_CHAIN_ID=8453             # Base mainnet
```

---

## Architecture decisions

| Decision | Why |
|----------|-----|
| No IPFS | SVG generated by contract via `tokenURI()` â€” zero external deps |
| Commit-reveal | Future blockhash in the seed prevents front-running / sniping |
| `extcodesize` guard in `_swapAndBurn` | Graceful fallback to treasury when WETH not deployed (e.g., local test env) |
| `via_ir = true` in foundry.toml | PixelRenderer.sol exceeds stack depth without IR pipeline |
| `next/og` for OG images | Avoids native Canvas dep (broken on Node v25); embeds SVG as base64 |
| TypeScript renderer mirrors Solidity | JS preview = guaranteed match to minted result |
| 64-bit seeds in JS preview | Trait bytes 4â€“7 live at bit offsets 32â€“63; 32-bit seeds locked eyes/accessory/special to index 0 |

---

## Renderer parity

The TypeScript renderer in `lib/renderer.ts` and the Solidity renderer in `PixelRenderer.sol` must produce identical SVG output for any given seed. All 12 canonical preset seeds from the original reference sprite are used as visual regression test cases in CI.

---

## Contributing

PRs welcome. All changes go through a PR â€” direct pushes to `master` are disabled.

1. Fork or branch from `master`
2. Make your changes
3. Open a PR â€” bugbot will scan for issues automatically
4. Squash-merge after review

---

## License

MIT â€” art is onchain, code is open.

---

*Built by [@ClawdiaETH](https://x.com/ClawdiaETH) Â· Deployed on [Base](https://base.org) Â· Burns [$CLAWDIA](https://basescan.org/token/0xbbd9aDe16525acb4B336b6dAd3b9762901522B07)*
